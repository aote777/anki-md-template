<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>anki-mdæ¨¡æ¿æµ‹è¯•</title>
  </head>
  <style>
    /* è¿™ä¸ªéœ€è¦å¤åˆ¶åˆ°ankiçš„cssæ ·å¼çš„é‚£ä¸ªçª—å£é‡Œ */
    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }

    @media (max-width: 767px) {
      .markdown-body {
        padding: 15px;
      }
    }
  </style>
  <body>
    <textarea class="md-content">
* å“ˆå“ˆ

- [x] ??

- [ ] 22

[ç™¾åº¦](http://baidu.com)

```
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
```
</textarea
    >

    <textarea class="md-content">
* åºåˆ—

- zheè¿™éƒ½å‡ºæ¥äº†

+ è¯•è¯•

> å¼•å…¥çš„è¯è¯é‡Œæœ‰è¯

| ni | wo |
| :--:|:--:|
| 1|2|

* base64å›¾ç‰‡æµ‹è¯•

![å›¾ç‰‡æµ‹è¯•][img1]


[img1]:data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABQODxIPDRQSEBIXFRQYHjIhHhwcHj0sLiQySUBMS0dARkVQWnNiUFVtVkVGZIhlbXd7gYKBTmCNl4x9lnN+gXz/2wBDARUXFx4aHjshITt8U0ZTfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHz/wAARCAA/AHYDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDr6KKXaaAEopdpo2mgBKKXaaQjFABRUczEKNpIyew9qhV5c/Mzjnjj/wCxoAtUVVMzqznPQdChx7VIJW2kjLnPPykY/TNAE1FV0mkJI2559xj9KsUAFFFFABRRRQAU8dBTKeOgoArahdPa22+KPzZWIVFzgEn1NYukzahY3RS9g/dXMv3vM3FWPTueK2NSjD2+4kAIdxyccVnWpguLiNYZVZhhvvdvWobaZSSsblNbrT6Y3WrJGOu4r6DmoRb7MbcHjBJwP5CrFFAFf7MNxOFHv3PrUnl5BznqSMMRUlFAEKQ4yW3Ak54c1NRRQAUUUUAFFFFABQZo0IVmwf5UUx4I5DuPBIwSDik79ARRe8jupj5Tq6KdvBz9ajitre1DGGNU3HJxUlposNnu8uQkscsTzk/nVp7MMMeZj8KYCW17E4ZDKpkjOGAOT7VZJBwR0xVC30mO3klZJmxKdzLjvV0KqKFToKWo9BaoakoYruUHEbkZ9eKtzxmSPCsVIOeCRn24rPkkkmTzFBIWN1w33skjgj8DWNZ+60zSmtblq4uY/KPkzpvLKPlIJ6gH+tWEzsXJycDJ9axpLpZXkCK3zoAo2n73r/KtlPuL9KKc+eTCceVDqKKK3MgooooAKKKKACiiigAooooAKKKKACqzWg84yRts3csMZyfWrNFTKKkrMabWxVFoQzMJMFv9n/69WI1KRorNuKgAnGM06ilGEY7Dcm9woooqyQooooAKKKKAP//Z
</textarea
    >
    <script>
      'use strict'
      function consoleLog(str) {
        var div = document.createElement('div')
        div.innerHTML = str
        document.body.appendChild(div)
      }
      var jqueryCdn =
        'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'
      var showDownCdn =
        'https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js'
      var highLightJs =
        'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js'
      var highLightCss =
        // 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css'
        'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/base16/onedark.min.css'
      var githubMarkdownCss =
        'https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.0.0/github-markdown.min.css'
      // åŠ è½½åº“æ–‡ä»¶
      var createScript = (src) => {
        var scriptElement = document.createElement('script')
        scriptElement.src = src
        scriptElement.type = 'text/javascript'
        document.head.appendChild(scriptElement)
        return new Promise((resolve) => {
          scriptElement.onload = function () {
            resolve(src)
          }
        })
      }

      // åŠ è½½cssæ–‡ä»¶
      var createLink = (url) => {
        var linkElement = document.createElement('link')
        linkElement.rel = 'stylesheet'
        linkElement.href = url

        linkElement.onload = () => {}

        document.head.appendChild(linkElement)
      }

      // æ¸…é™¤bræ ‡ç­¾
      // ankiè‡ªåŠ¨ç”Ÿæˆçš„<br>å…¨éƒ¨å¹²æ‰ ä¸¥æ ¼æŒ‰ç…§åŸç”Ÿæ¢è¡Œæ¥å†™
      var clearBR = (str) => {
        str = str.replace(/<br>/g, '\r\n')
        return str
      }

      var clearBlankNbsp=(str)=>{
        str = str.replace(/&nbsp;/g, ' ')
        return str
      }
      // è§£æï¼ˆå…¥å£æ–¹æ³•ï¼‰
      var parseMarkDown = () => {
        var convert = new showdown.Converter({
          // å¯ç”¨å¯¹mdä¸­å¯¹å›¾åƒå°ºå¯¸çš„æ”¯æŒ
          // ![foo](foo.jpg =100x80)     simple, assumes units are in px
          // ![bar](bar.jpg =100x*)      sets the height to "auto"
          // ![baz](baz.jpg =80%x5em)  Image with width of 80% and height of 5em
          parseImgDimensions: true,
          // å¯ç”¨å¯¹åˆ é™¤çº¿çš„æ”¯æŒ
          strikethrough: true,
          // å¯ç”¨å¯¹è¡¨æ ¼è¯­æ³•çš„æ”¯æŒ
          tables: true,
          // å¯ç”¨checkboxçš„æ”¯æŒ
          tasklists: true,
          // å°è¯•å·§å¦™åœ°ä¿®å¤ä¸ç¼©è¿›ä»£ç ä¸­é—´ä¸ es6 æ¨¡æ¿å­—ç¬¦ä¸²ç›¸å…³çš„ç¼©è¿›é—®é¢˜
          smartIndentationFix: true,
          // å°†æ¢è¡Œç¬¦è§£æä¸º <br>ï¼Œè¡Œå°¾ä¸éœ€è¦2ä¸ªç©ºæ ¼
          simpleLineBreaks: true,
          // åæ–œæ è½¬ä¹‰html
          backslashEscapesHTMLTags: true,
          // ç¦ç”¨å°†å­åˆ—è¡¨ç¼©è¿›4ä¸ªç©ºæ ¼ä»¥ä½¿å…¶åµŒå¥—çš„è¦æ±‚ï¼Œæœ‰æ•ˆåœ°æ¢å¤åˆ°2æˆ–3ä¸ªç©ºæ ¼è¶³å¤Ÿçš„æ—§è¡Œä¸º
          // disableforced4spacesindentedsublist: true,
          ghCodeBlocks: true,
        })
        // å¥½åƒæ˜¯å¤±æ•ˆçš„ï¼Ÿï¼Ÿä¸ç®¡ç”¨å‘¢
        // convert.setFlavor('github')
        document.querySelectorAll('.md-content').forEach((textarea, index) => {
          console.log('æŸ¥æ‰¾åˆ°çš„textareaå…ƒç´ ', textarea)
          textarea.innerHTML=clearBlankNbsp(textarea.innerHTML)
          var text = textarea.value
          var thisConverterSpecificOptions = convert.getOptions()
          console.log('å½“å‰çš„é…ç½®é¡¹', thisConverterSpecificOptions)
          // æ¸…é™¤bræ ‡ç­¾è¯•è¯•
          text = clearBR(text)
          // ğŸ‘‡å…³é”®æ ¸å¿ƒmdè½¬æ¢
          var html = convert.makeHtml(text)
          var newDiv = document.createElement('div')
          var hr = document.createElement('hr')
          newDiv.innerHTML = html
          // æ¿€æ´»github-markdown-css
          newDiv.className = 'markdown-body'
          textarea.parentNode.insertBefore(newDiv, textarea.nextSibling)

          index === 1
            ? textarea.parentNode.insertBefore(hr, textarea.nextSibling)
            : null
          textarea.className = `x-${index}`
          textarea.style.display = 'none'
          // ä¸èƒ½ä»bodyç›´æ¥æ’å…¥å…ƒç´  anki ä¸åˆ·æ–°çš„ æ·¦
        })
      }
      createLink(githubMarkdownCss)
      createLink(highLightCss)

      createScript(showDownCdn)
        .then(() => {
          return createScript(highLightJs)
        })
        .then(() => {
          // ankiæ¨¡æ¿æ— æ³•ä½¿ç”¨window.onloadæˆ‘æ€€ç–‘æ˜¯è¢«å ç”¨äº†
          // window.onload = parseMarkDown

          // å¯ä»¥å°è¯•æ‰‹åŠ¨æ¸…é™¤ankiç”Ÿæˆçš„<br>

          parseMarkDown()
          return new Promise((resolve) => {
            resolve()
          })
        })
        .then(() => {
          // è‡ªåŠ¨ä»£ç é«˜äº®
          hljs.highlightAll()
          return new Promise((resolve) => {
            resolve()
          })
        })
        .then(() => {
          // æ¸…é™¤é‡å¤é¡¹ è¯•è¯•
          var repeatEl = document.querySelectorAll('.x-0')
          repeatEl.forEach((el, i) => {
            if (i === repeatEl.length - 1) {
              return
            }
            document.body.removeChild(el)
          })
        })
    </script>
  </body>
</html>
